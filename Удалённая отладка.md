# Инструкция: отладка запущенного процесса .NET 6 в Linux-VM через SSH (Visual Studio)

## 1. Настройка сети VMware
Чтобы Visual Studio могла достучаться до виртуалки, у них должен быть сетевой канал.

1. **Выключи** виртуалку.
2. В VMware Workstation:
   - **VM → Settings → Network Adapter**.
   - Выбери:
     - **Bridged** — VM в одной сети с хостом и роутером.
     - **Host-Only** — только связь Windows ↔ VM, без выхода в интернет.
3. Запусти виртуалку.
4. В Linux-VM выполни:
   ```bash
   ip addr show
   ```
   Найди интерфейс с IP (обычно `eth0` или `ens33`), например:
   ```
   inet 192.168.1.55/24
   ```
   Здесь `192.168.1.55` — IP виртуалки.

---

## 2. Установка и настройка SSH на Linux-VM
1. Установи OpenSSH Server:
   ```bash
   sudo apt update
   sudo apt install openssh-server -y
   ```
2. Включи автозапуск и запусти сервис:
   ```bash
   sudo systemctl enable ssh
   sudo systemctl start ssh
   ```
3. Убедись, что SSH слушает порт:
   ```bash
   sudo systemctl status ssh
   ```
   Должно быть `Active: active (running)`.

4. С Windows проверь соединение:
   ```powershell
   ssh <имя_пользователя>@<IP_VM>
   ```
   Пример:
   ```powershell
   ssh alex@192.168.1.55
   ```

---

## 3. Узнаём имя пользователя виртуалки
Если забыл:
```bash
whoami
```

---

## 4. Подготовка приложения на Windows
1. В Windows собери приложение с отладочными символами:
   ```powershell
   dotnet publish -r linux-x64 -c Debug
   ```
2. Скопируй папку публикации на VM:
   ```powershell
   scp -r bin/Debug/net6.0/linux-x64/publish alex@192.168.1.55:/home/alex/app
   ```

---

## 5. Установка vsdbg на VM (автоматически из VS)
Для подключения к процессу Visual Studio потребуется **vsdbg**.  
В нашем варианте его поставит сама Visual Studio (ручная установка не нужна).

---

## 6. Запуск приложения на VM
```bash
cd /home/alex/app
~/.dotnet/dotnet MyApp.dll
```

---

## 7. Подключение к процессу из Visual Studio
1. На Windows открой свой проект в **Visual Studio**.
2. В меню выбери:
   ```
   Debug → Attach to Process...
   ```
3. В поле **Connection Type** выбери:
   ```
   SSH
   ```
4. В поле **Connection target** введи:
   ```
   alex@192.168.1.55
   ```
5. Нажми **Connect**.
6. Если vsdbg не установлен, VS предложит его скачать и поставить на VM — соглашайся.
7. После подключения VS покажет список процессов на VM.
8. Найди свой процесс, например:
   ```
   dotnet /home/alex/app/MyApp.dll
   ```
9. Выдели его и нажми **Attach**.

---

## 8. Отладка
- Ставь брейкпоинты прямо в коде.
- VS остановит процесс на точке останова.
- Можно смотреть переменные, стек вызовов, значения параметров.

---

## 9. Проверка соединения, если что-то не работает
- Пинг с Windows:
  ```powershell
  ping 192.168.1.55
  ```
- Проверка SSH:
  ```powershell
  ssh alex@192.168.1.55
  ```
- Проверка, что процесс запущен на VM:
  ```bash
  ps aux | grep dotnet
  ```
